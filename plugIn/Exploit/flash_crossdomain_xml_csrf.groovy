import org.jsoup.Jsoup
import org.jsoup.Connection.Method
import org.jsoup.nodes.Document
import org.jsoup.nodes.Element

import attack.HttpRequestHandler
import bean.ExpResult


class Flash_Crossdomain_Xml_CSRF{
	static exp(host,port){
		if(port==443)
			host="https://"+host;
		if(port==80||port==0)
			host="http://"+host;
		String poc="/crossdomain.xml"
		host+=poc;
		HttpRequestHandler request =HttpRequestHandler.getInstance();
		ExpResult result=request.doRequest(host,Method.GET,,null);
		if (result==null) {
			println 'request error'
			return null;
		}
		Document doc = Jsoup.parse(new ByteArrayInputStream(result.entity),null,host);
		if(!doc.toString().contains('<cross-domain-polic')){
			return null;
		}
		for (Element element in doc.getElementsByTag('allow-access-from')) {
			if("*".equals(element.attr("domain"))){
				println element.toString()
				println "exp is ok"
				return null;
			}
		}
		println "false"
		request.closeClient()
	}
}
Flash_Crossdomain_Xml_CSRF.exp(host,port)